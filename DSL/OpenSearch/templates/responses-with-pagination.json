{
  "script": {
    "lang": "mustache",
    "source": "{\"query\":{\"term\":{\"_id\":\"responses\"}},\"script_fields\":{\"filtered_responses\":{\"script\":{\"lang\":\"painless\",\"source\":\"def responses = params._source.responses; def searchTerm = '{{filter}}'; int from = {{from}}; int size = {{size}}; def filteredResponses = new HashMap(); for (def entry : responses.entrySet()) { def responseName = entry.getKey(); if (searchTerm == '' || responseName.toLowerCase().contains(searchTerm.toLowerCase())) { filteredResponses.put(responseName, entry.getValue()); } } int start = (int)Math.min(from, filteredResponses.size()); int end = (int)Math.min(from + size, filteredResponses.size()); def paginatedResponses = new HashMap(); int counter = 0; for (def entry : filteredResponses.entrySet()) { if (counter >= start && counter < end) { paginatedResponses.put(entry.getKey(), entry.getValue()); } counter++; } return paginatedResponses;\"}},\"total_count\":{\"script\":{\"lang\":\"painless\",\"source\":\"def responses = params._source.responses; def searchTerm = '{{filter}}'; def filteredResponses = new HashMap(); for (def entry : responses.entrySet()) { def responseName = entry.getKey(); if (searchTerm == '' || responseName.toLowerCase().contains(searchTerm.toLowerCase())) { filteredResponses.put(responseName, entry.getValue()); } } return (int)filteredResponses.size();\"}}}}"
  }
}
